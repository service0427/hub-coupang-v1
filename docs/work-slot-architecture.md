# Work Slot 시스템 아키텍처

## 1. 개요

### 1.1 배경
- **기존 방식**: 에이전트가 프록시를 고정하고 키워드를 가져가는 Pull 방식
- **신규 방식**: 허브가 프록시+키워드+설정을 패키지로 할당하는 Push 방식

### 1.2 핵심 변경사항
1. 중앙 집중식 작업 관리
2. 외부 사이트 요청 기반 작업 생성
3. 서비스 기간(슬롯) 관리
4. 클라이언트 자동 발견 및 추적
5. TLS 핀거프린트 회피를 위한 유저 폴더 로테이션

## 2. 시스템 구성요소

### 2.1 Work Slot (작업 슬롯)
- 외부 사이트에서 접수된 작업 단위
- 키워드 + 코드 + 서비스 기간 + 일별 작업량으로 구성
- 블록 설정(CDN 차단 옵션) 포함

### 2.2 Client (클라이언트)
- 실제 작업을 수행하는 서버/VM
- IP 기반 자동 등록
- 인스턴스 1~12개 운영 가능

### 2.3 Instance (인스턴스)
- 클라이언트 내 독립 실행 단위
- 각 인스턴스당 30개 유저 폴더 운영
- 순환 로테이션으로 TLS 핀거프린트 회피

### 2.4 Work Allocation (작업 할당)
- 프록시 + 키워드 + 설정 패키지
- 5분 타임아웃
- 중복 방지 메커니즘

## 3. 데이터 흐름

```
[외부 사이트] 
    ↓ (작업 요청)
[Work Slot 생성]
    ↓
[Daily Tracking 초기화] (매일 자정)
    ↓
[클라이언트 작업 요청]
    ↓
[프록시 + 키워드 할당]
    ↓
[작업 수행]
    ↓
[결과 보고]
    ↓
[통계 집계]
```

## 4. 핵심 정책

### 4.1 프록시 관리
- 사용 횟수 20회 제한
- 자동 IP 토글
- IP-키워드 제한 (1분, 10분 규칙)

### 4.2 클라이언트 관리
- IP 기반 자동 등록
- 인스턴스/폴더 사용 패턴 추적
- 성능 모니터링

### 4.3 작업 할당
- 일별 목표량 관리
- 우선순위 기반 할당
- 중복 방지 (allocation_key)

### 4.4 블록 설정
- cart_click_enabled: 장바구니 클릭 여부
- block_mercury: Mercury CDN 차단
- block_image_cdn: 이미지 CDN 차단
- block_img1a_cdn: IMG1A CDN 차단
- block_thumbnail_cdn: 썸네일 CDN 차단

## 5. 모니터링 포인트

1. **일별 진행률**: 목표 대비 완료율
2. **클라이언트 상태**: 활성/비활성, 인스턴스 사용률
3. **블록률**: 설정별 블록 발생률
4. **성공률**: 시간대별, 설정별 성공률
5. **프록시 상태**: 사용량, 토글 현황

## 6. 확장 가능성

- 다양한 외부 사이트 지원
- 동적 설정 조정 (A/B 테스트)
- 자동 최적화 알고리즘
- 실시간 모니터링 대시보드